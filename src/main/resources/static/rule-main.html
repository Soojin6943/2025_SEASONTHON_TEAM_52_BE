<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì˜¤ëŠ˜ì˜ ë£¸ë©”ì´íŠ¸ ê·œì¹™</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f8f9fa;
      }
      .header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }
      .header h1 {
        margin: 0;
        font-size: 2em;
      }
      .date {
        margin-top: 10px;
        font-size: 1.2em;
        opacity: 0.9;
      }
      .rule-card {
        background: white;
        padding: 20px;
        margin: 15px 0;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #667eea;
        transition: transform 0.2s;
      }
      .rule-card:hover {
        transform: translateY(-2px);
      }
      .rule-content {
        font-size: 1.1em;
        color: #333;
        margin-bottom: 10px;
      }
      .rule-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: #666;
        font-size: 0.9em;
      }
      .week-number {
        background: #667eea;
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8em;
      }
      .no-rules {
        text-align: center;
        padding: 40px;
        color: #666;
        font-size: 1.1em;
      }
      .no-rules-icon {
        font-size: 3em;
        margin-bottom: 20px;
        opacity: 0.5;
      }
      .space-selector {
        text-align: center;
        margin-bottom: 20px;
      }
      .space-selector select {
        padding: 10px 15px;
        border: 2px solid #667eea;
        border-radius: 25px;
        font-size: 1em;
        background: white;
        cursor: pointer;
      }
      .refresh-btn {
        background: #667eea;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 20px;
        cursor: pointer;
        margin-left: 10px;
        font-size: 0.9em;
      }
      .refresh-btn:hover {
        background: #5a6fd8;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>ğŸ  ì˜¤ëŠ˜ì˜ ë£¸ë©”ì´íŠ¸ ê·œì¹™</h1>
      <div class="date" id="todayDate"></div>
    </div>

    <div class="space-selector">
      <label for="spaceSelect">ìŠ¤í˜ì´ìŠ¤ ì„ íƒ: </label>
      <select id="spaceSelect" onchange="loadTodayRules()">
        <option value="1">ìŠ¤í˜ì´ìŠ¤ 1</option>
        <option value="2">ìŠ¤í˜ì´ìŠ¤ 2</option>
        <option value="3">ìŠ¤í˜ì´ìŠ¤ 3</option>
      </select>
      <button class="refresh-btn" onclick="loadTodayRules()">
        ğŸ”„ ìƒˆë¡œê³ ì¹¨
      </button>
    </div>

    <div id="rulesContainer">
      <!-- ì—¬ê¸°ì— ì˜¤ëŠ˜ ê·œì¹™ë“¤ì´ í‘œì‹œë©ë‹ˆë‹¤ -->
    </div>

    <script>
      // ì˜¤ëŠ˜ ë‚ ì§œ í‘œì‹œ
      function updateTodayDate() {
        const today = new Date();
        const options = {
          year: "numeric",
          month: "long",
          day: "numeric",
          weekday: "long",
        };
        document.getElementById("todayDate").textContent =
          today.toLocaleDateString("ko-KR", options);
      }

      // ì˜¤ëŠ˜ ê·œì¹™ ë¡œë“œ
      async function loadTodayRules() {
        const spaceId = document.getElementById("spaceSelect").value;
        const container = document.getElementById("rulesContainer");

        try {
          const response = await fetch(`/api/rules/space/${spaceId}/today`);
          if (response.ok) {
            const rules = await response.json();
            displayRules(rules);
          } else {
            const errorResponse = await response.json();
            let errorMessage = "ì˜¤ëŠ˜ ê·œì¹™ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤";
            if (errorResponse.message) {
              errorMessage += ": " + errorResponse.message;
            }
            showError(errorMessage);
          }
        } catch (error) {
          showError("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);
        }
      }

      // ê·œì¹™ í‘œì‹œ
      function displayRules(rules) {
        const container = document.getElementById("rulesContainer");

        if (rules.length === 0) {
          container.innerHTML = `
                    <div class="no-rules">
                        <div class="no-rules-icon">ğŸ‰</div>
                        <div>ì˜¤ëŠ˜ì€ íŠ¹ë³„í•œ ê·œì¹™ì´ ì—†ìŠµë‹ˆë‹¤!</div>
                        <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.7;">
                            ëª¨ë“  ê·œì¹™ì„ ë³´ë ¤ë©´ ì„¤ì •ì—ì„œ í™•ì¸í•˜ì„¸ìš”
                        </div>
                    </div>
                `;
        } else {
          container.innerHTML = rules
            .map(
              (rule) => `
                    <div class="rule-card">
                        <div class="rule-content">${rule.content}</div>
                        <div class="rule-info">
                            <span>${getWeekdayText(rule.weekdays)}</span>
                            <span class="week-number">${
                              rule.weekInterval
                            }ì£¼ë§ˆë‹¤</span>
                        </div>
                    </div>
                `
            )
            .join("");
        }
      }

      // ìš”ì¼ í…ìŠ¤íŠ¸ ë³€í™˜
      function getWeekdayText(weekdays) {
        const weekdayMap = {
          MONDAY: "ì›”ìš”ì¼",
          TUESDAY: "í™”ìš”ì¼",
          WEDNESDAY: "ìˆ˜ìš”ì¼",
          THURSDAY: "ëª©ìš”ì¼",
          FRIDAY: "ê¸ˆìš”ì¼",
          SATURDAY: "í† ìš”ì¼",
          SUNDAY: "ì¼ìš”ì¼",
        };

        return Array.from(weekdays)
          .map((day) => weekdayMap[day])
          .join(", ");
      }

      // ì—ëŸ¬ í‘œì‹œ
      function showError(message) {
        const container = document.getElementById("rulesContainer");
        container.innerHTML = `
                <div class="no-rules">
                    <div class="no-rules-icon">âš ï¸</div>
                    <div>${message}</div>
                </div>
            `;
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
      document.addEventListener("DOMContentLoaded", function () {
        updateTodayDate();
        loadTodayRules();
      });
    </script>
  </body>
</html>
