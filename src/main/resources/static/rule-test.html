<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë£¸ë©”ì´íŠ¸ ê·œì¹™ ê´€ë¦¬ í…ŒìŠ¤íŠ¸</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .form-group {
        margin-bottom: 20px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #555;
      }
      input,
      select,
      textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
      }
      .weekdays {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .weekday-checkbox {
        display: flex;
        align-items: center;
        gap: 5px;
      }
      .weekday-checkbox input {
        width: auto;
      }
      button {
        background-color: #007bff;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-right: 10px;
      }
      button:hover {
        background-color: #0056b3;
      }
      .result {
        margin-top: 30px;
        padding: 20px;
        background-color: #f8f9fa;
        border-radius: 5px;
        border-left: 4px solid #007bff;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ  ë£¸ë©”ì´íŠ¸ ê·œì¹™ ê´€ë¦¬</h1>

      <form id="ruleForm">
        <div class="form-group">
          <label for="spaceId">ìŠ¤í˜ì´ìŠ¤ ID:</label>
          <input type="number" id="spaceId" value="1" required />
        </div>

        <div class="form-group">
          <label for="content">ê·œì¹™ ë‚´ìš©:</label>
          <textarea
            id="content"
            rows="3"
            placeholder="ì˜ˆ: ì§‘ì²­ì†Œ ë‹¹ë²ˆ: ê¹€íƒœí¬"
            required
          ></textarea>
        </div>

        <div class="form-group">
          <label>ìš”ì¼ ì„ íƒ:</label>
          <div class="weekdays">
            <div class="weekday-checkbox">
              <input type="checkbox" id="monday" value="MONDAY" />
              <label for="monday">ì›”ìš”ì¼</label>
            </div>
            <div class="weekday-checkbox">
              <input type="checkbox" id="tuesday" value="TUESDAY" />
              <label for="tuesday">í™”ìš”ì¼</label>
            </div>
            <div class="weekday-checkbox">
              <input type="checkbox" id="wednesday" value="WEDNESDAY" />
              <label for="wednesday">ìˆ˜ìš”ì¼</label>
            </div>
            <div class="weekday-checkbox">
              <input type="checkbox" id="thursday" value="THURSDAY" />
              <label for="thursday">ëª©ìš”ì¼</label>
            </div>
            <div class="weekday-checkbox">
              <input type="checkbox" id="friday" value="FRIDAY" />
              <label for="friday">ê¸ˆìš”ì¼</label>
            </div>
            <div class="weekday-checkbox">
              <input type="checkbox" id="saturday" value="SATURDAY" />
              <label for="saturday">í† ìš”ì¼</label>
            </div>
            <div class="weekday-checkbox">
              <input type="checkbox" id="sunday" value="SUNDAY" />
              <label for="sunday">ì¼ìš”ì¼</label>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="weekInterval">ì£¼ê¸°:</label>
          <select id="weekInterval" required>
            <option value="1">1ì£¼ë§ˆë‹¤</option>
            <option value="2" selected>2ì£¼ë§ˆë‹¤</option>
            <option value="3">3ì£¼ë§ˆë‹¤</option>
            <option value="4">4ì£¼ë§ˆë‹¤</option>
          </select>
        </div>

        <div class="form-group">
          <label for="startDate">ì‹œì‘ ë‚ ì§œ:</label>
          <input type="date" id="startDate" required />
        </div>

        <div class="form-group">
          <label for="endDate">ì¢…ë£Œ ë‚ ì§œ (ì„ íƒì‚¬í•­):</label>
          <input type="date" id="endDate" />
        </div>

        <button type="submit">ê·œì¹™ ìƒì„±</button>
        <button type="button" onclick="getRules()">ì „ì²´ ê·œì¹™ ì¡°íšŒ</button>
        <button type="button" onclick="getTodayRules()">ì˜¤ëŠ˜ ê·œì¹™ ì¡°íšŒ</button>
      </form>

      <div id="result" class="result" style="display: none"></div>
    </div>

    <script>
      // ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ì‹œì‘ ë‚ ì§œë¡œ ì„¤ì •
      document.getElementById("startDate").value = new Date()
        .toISOString()
        .split("T")[0];

      // ìˆ˜ìš”ì¼ ì²´í¬ (ì˜ˆì‹œ)
      document.getElementById("wednesday").checked = true;

      document
        .getElementById("ruleForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const weekdays = Array.from(
            document.querySelectorAll('input[type="checkbox"]:checked')
          ).map((cb) => cb.value);

          if (weekdays.length === 0) {
            alert("ìµœì†Œ í•˜ë‚˜ì˜ ìš”ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
            return;
          }

          const ruleData = {
            spaceId: parseInt(document.getElementById("spaceId").value),
            content: document.getElementById("content").value,
            weekdays: weekdays,
            weekInterval: parseInt(
              document.getElementById("weekInterval").value
            ),
            startDate: document.getElementById("startDate").value,
            endDate: document.getElementById("endDate").value || null,
          };

                     try {
             const response = await fetch("/api/rules", {
               method: "POST",
               headers: {
                 "Content-Type": "application/json",
               },
               body: JSON.stringify(ruleData),
             });
 
             if (response.ok) {
               const result = await response.json();
               showResult("ê·œì¹™ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!", result);
             } else {
               const errorResponse = await response.json();
               let errorMessage = "ê·œì¹™ ìƒì„± ì‹¤íŒ¨";
               if (errorResponse.message) {
                 errorMessage += ": " + errorResponse.message;
               }
               showResult("ê·œì¹™ ìƒì„± ì‹¤íŒ¨", errorMessage);
             }
           } catch (error) {
             showResult("ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬", "ì„œë²„ì™€ì˜ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: " + error.message);
           }
        });

             async function getRules() {
         const spaceId = document.getElementById("spaceId").value;
 
         try {
           const response = await fetch(`/api/rules/space/${spaceId}`);
           if (response.ok) {
             const rules = await response.json();
             showResult("ìŠ¤í˜ì´ìŠ¤ ê·œì¹™ ëª©ë¡", rules);
           } else {
             const errorResponse = await response.json();
             let errorMessage = "ê·œì¹™ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤";
             if (errorResponse.message) {
               errorMessage += ": " + errorResponse.message;
             }
             showResult("ê·œì¹™ ì¡°íšŒ ì‹¤íŒ¨", errorMessage);
           }
         } catch (error) {
           showResult("ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬", "ì„œë²„ì™€ì˜ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: " + error.message);
         }
       }
 
       async function getTodayRules() {
         const spaceId = document.getElementById("spaceId").value;
 
         try {
           const response = await fetch(`/api/rules/space/${spaceId}/today`);
           if (response.ok) {
             const rules = await response.json();
             if (rules.length === 0) {
               showResult("ì˜¤ëŠ˜ ê·œì¹™", "ì˜¤ëŠ˜ ì‹¤í–‰ë˜ëŠ” ê·œì¹™ì´ ì—†ìŠµë‹ˆë‹¤.");
             } else {
               showResult("ì˜¤ëŠ˜ ì‹¤í–‰ë˜ëŠ” ê·œì¹™", rules);
             }
           } else {
             const errorResponse = await response.json();
             let errorMessage = "ì˜¤ëŠ˜ ê·œì¹™ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤";
             if (errorResponse.message) {
               errorMessage += ": " + errorResponse.message;
             }
             showResult("ì˜¤ëŠ˜ ê·œì¹™ ì¡°íšŒ ì‹¤íŒ¨", errorMessage);
           }
         } catch (error) {
           showResult("ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬", "ì„œë²„ì™€ì˜ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: " + error.message);
         }
       }

      function showResult(title, data) {
        const resultDiv = document.getElementById("result");
        resultDiv.style.display = "block";
        resultDiv.innerHTML = `
                <h3>${title}</h3>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
      }
    </script>
  </body>
</html>
